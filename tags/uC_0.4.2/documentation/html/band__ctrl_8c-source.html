<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>uC: front_panel/band_ctrl.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>front_panel/band_ctrl.c</h1><a href="band__ctrl_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00008"></a>00008 <span class="comment">//    Copyright (C) 2009  Mikael Larsmark, SM2WMV</span>
<a name="l00009"></a>00009 <span class="comment">//</span>
<a name="l00010"></a>00010 <span class="comment">//    This program is free software: you can redistribute it and/or modify</span>
<a name="l00011"></a>00011 <span class="comment">//    it under the terms of the GNU General Public License as published by</span>
<a name="l00012"></a>00012 <span class="comment">//    the Free Software Foundation, either version 3 of the License, or</span>
<a name="l00013"></a>00013 <span class="comment">//    (at your option) any later version.</span>
<a name="l00014"></a>00014 <span class="comment">//</span>
<a name="l00015"></a>00015 <span class="comment">//    This program is distributed in the hope that it will be useful,</span>
<a name="l00016"></a>00016 <span class="comment">//    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00017"></a>00017 <span class="comment">//    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00018"></a>00018 <span class="comment">//    GNU General Public License for more details.</span>
<a name="l00019"></a>00019 <span class="comment">//</span>
<a name="l00020"></a>00020 <span class="comment">//    You should have received a copy of the GNU General Public License</span>
<a name="l00021"></a>00021 <span class="comment">//    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;avr/io.h&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;avr/interrupt.h&gt;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#include "<a class="code" href="band__ctrl_8h.html" title="Band control functions.">band_ctrl.h</a>"</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include "main.h"</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include "<a class="code" href="eeprom_8h.html" title="EEPROM functions.">eeprom.h</a>"</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include "led_control.h"</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include "<a class="code" href="radio__interface_8h.html" title="Radio interface, such as PTT AMP, PTT Radio, CAT etc.">radio_interface.h</a>"</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include "<a class="code" href="sub__menu_8h.html" title="Antenna sub menu functions.">sub_menu.h</a>"</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include "../global.h"</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="preprocessor">#include "../internal_comm.h"</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="comment">/* Include the bus headers */</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include "../wmv_bus/bus.h"</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include "../wmv_bus/bus_rx_queue.h"</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include "../wmv_bus/bus_tx_queue.h"</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include "../wmv_bus/bus_commands.h"</span>
<a name="l00043"></a>00043 
<a name="l00045"></a><a class="code" href="band__ctrl_8c.html#dddd969c7e4f721ab1659c1ab3a946ce">00045</a> <a class="code" href="structstruct__band.html" title="Struct of band data.">struct_band</a> <a class="code" href="band__ctrl_8c.html#dddd969c7e4f721ab1659c1ab3a946ce" title="Contains the current band information.">current_band</a>;
<a name="l00046"></a>00046 
<a name="l00048"></a><a class="code" href="band__ctrl_8c.html#99322d1503c4eddf338c256c99fb52e2">00048</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="band__ctrl_8c.html#99322d1503c4eddf338c256c99fb52e2" title="Array which we use to keep track of which devices we have been activating outputs...">current_band_activated_outputs</a>[<a class="code" href="front__panel_2main_8h.html#7670a4e73127c06ec1c0cd2cdc74f737" title="The max size of the band output str.">BAND_OUTPUT_STR_SIZE</a>];
<a name="l00050"></a><a class="code" href="band__ctrl_8c.html#95dd3b6a390eb053adecba3f5fee3d5d">00050</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="band__ctrl_8c.html#95dd3b6a390eb053adecba3f5fee3d5d" title="The number of devices we have activated outputs on.">current_band_activated_outputs_length</a> = 0;
<a name="l00051"></a>00051 
<a name="l00053"></a><a class="code" href="band__ctrl_8c.html#04e64b2486df76aaf97baf61ff70896a">00053</a> <span class="keywordtype">void</span> <a class="code" href="band__ctrl_8c.html#04e64b2486df76aaf97baf61ff70896a" title="Send the output string for the current band to the bus.">band_ctrl_send_band_data_to_bus</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> band_portion) {
<a name="l00054"></a>00054         <span class="keywordflow">if</span> (<a class="code" href="front__panel_2main_8h.html#44180c9bab74233e1e4e36be5bcf2fe1" title="Contains different statuses of buttons etc.">status</a>.<a class="code" href="structstruct__status.html#96014d1883e414c343243dc470986d1c" title="The currently selected band.">selected_band</a> != BAND_UNDEFINED) {
<a name="l00055"></a>00055                 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> length = 0;
<a name="l00056"></a>00056                 
<a name="l00057"></a>00057                 <span class="keywordflow">if</span> (band_portion == BAND_HIGH)
<a name="l00058"></a>00058                         length = current_band.<a class="code" href="structstruct__band.html#f688643f9ccb24706166e4eaf79b5544" title="The length of the high output str.">band_high_output_str_length</a>;
<a name="l00059"></a>00059                 <span class="keywordflow">else</span>
<a name="l00060"></a>00060                         length = current_band.<a class="code" href="structstruct__band.html#0b545174b90a4a48f54853b2f7b42a1b" title="The length of the low output str.">band_low_output_str_length</a>;
<a name="l00061"></a>00061                 
<a name="l00062"></a>00062                 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> temp[length];
<a name="l00063"></a>00063 
<a name="l00064"></a>00064                 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> addr = 0;
<a name="l00065"></a>00065                 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> start_pos = 0;
<a name="l00066"></a>00066                 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> count = 0;
<a name="l00067"></a>00067                 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> addr_count = 0;
<a name="l00068"></a>00068 
<a name="l00069"></a>00069                 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> i=0;
<a name="l00070"></a>00070 
<a name="l00071"></a>00071                 <a class="code" href="band__ctrl_8c.html#7081025e6923a7a4d8d35e61144f494e" title="Function which will deactiavate all band outptus, BUS_CMD_DRIVER_DEACTIVATE_ALL_BAND_OUTPUTS...">band_ctrl_deactivate_all</a>();
<a name="l00072"></a>00072 
<a name="l00073"></a>00073                 <span class="keywordflow">while</span>(i&lt;length) {
<a name="l00074"></a>00074                         <span class="keywordflow">if</span> (band_portion == BAND_HIGH) {
<a name="l00075"></a>00075                                 <span class="keywordflow">if</span> (current_band.<a class="code" href="structstruct__band.html#24999518468ee9a16fb8c33eb6ad6d98" title="These outputs are activated when you enter the high area of a band.">band_high_output_str</a>[i] == <a class="code" href="front__panel_2main_8h.html#91afd03683ce572620f032008c7ccd3e" title="The delimiter that seperates the outputs from which address they should be sent to...">OUTPUT_ADDR_DELIMITER</a>) {
<a name="l00076"></a>00076                                         addr = current_band.<a class="code" href="structstruct__band.html#24999518468ee9a16fb8c33eb6ad6d98" title="These outputs are activated when you enter the high area of a band.">band_high_output_str</a>[i+1];
<a name="l00077"></a>00077 
<a name="l00078"></a>00078                                         <a class="code" href="band__ctrl_8c.html#99322d1503c4eddf338c256c99fb52e2" title="Array which we use to keep track of which devices we have been activating outputs...">current_band_activated_outputs</a>[addr_count++] = addr;
<a name="l00079"></a>00079                                         <a class="code" href="band__ctrl_8c.html#95dd3b6a390eb053adecba3f5fee3d5d" title="The number of devices we have activated outputs on.">current_band_activated_outputs_length</a>++;
<a name="l00080"></a>00080 
<a name="l00081"></a>00081                                         <span class="keywordflow">if</span> (addr != 0x00)
<a name="l00082"></a>00082                                                 <a class="code" href="bus_8c.html#4c78398b39ca1a317bcd94e32d3238ed" title="Adds a message to the TX queue which will be sent as soon as possible.">bus_add_tx_message</a>(<a class="code" href="bus_8c.html#978d35e07c79199b121997d80de56655" title="Returns the address of this device.">bus_get_address</a>(), addr, (1&lt;&lt;<a class="code" href="bus_8h.html#76bcceff22cba96905957274b8265298">BUS_MESSAGE_FLAGS_NEED_ACK</a>), <a class="code" href="bus__commands_8h.html#eee6892df89d7421dd9226e898c9810c">BUS_CMD_DRIVER_ACTIVATE_BAND_OUTPUT</a>, count-start_pos, temp+start_pos);
<a name="l00083"></a>00083                                         <span class="keywordflow">else</span>
<a name="l00084"></a>00084                                                 <a class="code" href="internal__comm_8c.html#d9191f782631f96ebe7a5d9d846ba97b" title="Add a message to the transmit queue.">internal_comm_add_tx_message</a>(<a class="code" href="bus__commands_8h.html#eee6892df89d7421dd9226e898c9810c">BUS_CMD_DRIVER_ACTIVATE_BAND_OUTPUT</a>, count-start_pos, (<span class="keywordtype">char</span> *)(temp+start_pos));
<a name="l00085"></a>00085         
<a name="l00086"></a>00086                                         start_pos += count;
<a name="l00087"></a>00087                                         i++;
<a name="l00088"></a>00088                                 }
<a name="l00089"></a>00089                                 <span class="keywordflow">else</span> {
<a name="l00090"></a>00090                                         temp[count] = current_band.<a class="code" href="structstruct__band.html#24999518468ee9a16fb8c33eb6ad6d98" title="These outputs are activated when you enter the high area of a band.">band_high_output_str</a>[i];
<a name="l00091"></a>00091                                         count++;
<a name="l00092"></a>00092                                 }
<a name="l00093"></a>00093                                 
<a name="l00094"></a>00094                                 i++;
<a name="l00095"></a>00095                         }
<a name="l00096"></a>00096                         <span class="keywordflow">else</span> {
<a name="l00097"></a>00097                                 <span class="keywordflow">if</span> (current_band.<a class="code" href="structstruct__band.html#010fd732dc84bdf3ba7e4f8424585571" title="These outputs are activated when you enter the low area of a band.">band_low_output_str</a>[i] == <a class="code" href="front__panel_2main_8h.html#91afd03683ce572620f032008c7ccd3e" title="The delimiter that seperates the outputs from which address they should be sent to...">OUTPUT_ADDR_DELIMITER</a>) {
<a name="l00098"></a>00098                                         addr = current_band.<a class="code" href="structstruct__band.html#010fd732dc84bdf3ba7e4f8424585571" title="These outputs are activated when you enter the low area of a band.">band_low_output_str</a>[i+1];
<a name="l00099"></a>00099                                         
<a name="l00100"></a>00100                                         <a class="code" href="band__ctrl_8c.html#99322d1503c4eddf338c256c99fb52e2" title="Array which we use to keep track of which devices we have been activating outputs...">current_band_activated_outputs</a>[addr_count++] = addr;
<a name="l00101"></a>00101                                         <a class="code" href="band__ctrl_8c.html#95dd3b6a390eb053adecba3f5fee3d5d" title="The number of devices we have activated outputs on.">current_band_activated_outputs_length</a>++;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103                                         <span class="keywordflow">if</span> (addr != 0x00)
<a name="l00104"></a>00104                                                 <a class="code" href="bus_8c.html#4c78398b39ca1a317bcd94e32d3238ed" title="Adds a message to the TX queue which will be sent as soon as possible.">bus_add_tx_message</a>(<a class="code" href="bus_8c.html#978d35e07c79199b121997d80de56655" title="Returns the address of this device.">bus_get_address</a>(), addr, (1&lt;&lt;<a class="code" href="bus_8h.html#76bcceff22cba96905957274b8265298">BUS_MESSAGE_FLAGS_NEED_ACK</a>), <a class="code" href="bus__commands_8h.html#eee6892df89d7421dd9226e898c9810c">BUS_CMD_DRIVER_ACTIVATE_BAND_OUTPUT</a>, count-start_pos, temp+start_pos);
<a name="l00105"></a>00105                                         <span class="keywordflow">else</span>
<a name="l00106"></a>00106                                                 <a class="code" href="internal__comm_8c.html#d9191f782631f96ebe7a5d9d846ba97b" title="Add a message to the transmit queue.">internal_comm_add_tx_message</a>(<a class="code" href="bus__commands_8h.html#eee6892df89d7421dd9226e898c9810c">BUS_CMD_DRIVER_ACTIVATE_BAND_OUTPUT</a>, count-start_pos, (<span class="keywordtype">char</span> *)(temp+start_pos));
<a name="l00107"></a>00107         
<a name="l00108"></a>00108                                         start_pos += count;
<a name="l00109"></a>00109                                         i++;
<a name="l00110"></a>00110                                 }
<a name="l00111"></a>00111                                 <span class="keywordflow">else</span> {
<a name="l00112"></a>00112                                         temp[count] = current_band.<a class="code" href="structstruct__band.html#010fd732dc84bdf3ba7e4f8424585571" title="These outputs are activated when you enter the low area of a band.">band_low_output_str</a>[i];
<a name="l00113"></a>00113                                         count++;
<a name="l00114"></a>00114                                 }
<a name="l00115"></a>00115                                 
<a name="l00116"></a>00116                                 i++;
<a name="l00117"></a>00117                         }
<a name="l00118"></a>00118                 }
<a name="l00119"></a>00119         }
<a name="l00120"></a>00120         <span class="keywordflow">else</span>
<a name="l00121"></a>00121                 <a class="code" href="band__ctrl_8c.html#7081025e6923a7a4d8d35e61144f494e" title="Function which will deactiavate all band outptus, BUS_CMD_DRIVER_DEACTIVATE_ALL_BAND_OUTPUTS...">band_ctrl_deactivate_all</a>();
<a name="l00122"></a>00122 }
<a name="l00123"></a>00123 
<a name="l00126"></a><a class="code" href="band__ctrl_8c.html#95c96792b3186a41830050229812285e">00126</a> <span class="keywordtype">void</span> <a class="code" href="band__ctrl_8c.html#95c96792b3186a41830050229812285e" title="Function will load a band from the EEPROM into the current_band struct.">band_ctrl_load_band</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> band) {
<a name="l00127"></a>00127         <span class="comment">//Retrieve the band data from the EEPROM</span>
<a name="l00128"></a>00128         <a class="code" href="eeprom_8c.html#6ec03600842aca7894be5d5e541552b6" title="Returns the band data.">eeprom_get_band_data</a>(band,&amp;current_band);
<a name="l00129"></a>00129         
<a name="l00130"></a>00130         <span class="comment">//Load the antenna settings for this band</span>
<a name="l00131"></a>00131         <a class="code" href="antenna__ctrl_8c.html#75cf7e57b9079e88c7a80607923292c9" title="Read the eeprom for the antenna settings.">antenna_ctrl_ant_read_eeprom</a>(band);
<a name="l00132"></a>00132         printf(<span class="stringliteral">"LOAD SUB: %i\n"</span>,band);
<a name="l00133"></a>00133         <span class="comment">//Load the sub menus for this band</span>
<a name="l00134"></a>00134         <a class="code" href="sub__menu_8c.html#1070bc0cf80e49b60d21255cb9e656bd" title="Load a set of sub menu from the EEPROM for a specific band.">sub_menu_load</a>(band);
<a name="l00135"></a>00135 }
<a name="l00136"></a>00136 
<a name="l00139"></a><a class="code" href="band__ctrl_8h.html#b5eb49c98d55e709f5fb8d2fe16db418">00139</a> <span class="keywordtype">void</span> <a class="code" href="band__ctrl_8c.html#b5eb49c98d55e709f5fb8d2fe16db418" title="Function will send out new band portion settings for the current selected band *...">band_ctrl_change_band_portion</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> band_portion) {
<a name="l00140"></a>00140         <a class="code" href="band__ctrl_8c.html#04e64b2486df76aaf97baf61ff70896a" title="Send the output string for the current band to the bus.">band_ctrl_send_band_data_to_bus</a>(band_portion);
<a name="l00141"></a>00141 }
<a name="l00142"></a>00142 
<a name="l00145"></a><a class="code" href="band__ctrl_8h.html#62c3930057e2cfe14c33d35ac57cfb56">00145</a> <span class="keywordtype">void</span> <a class="code" href="band__ctrl_8c.html#62c3930057e2cfe14c33d35ac57cfb56" title="Function used to change band.">band_ctrl_change_band</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> band) {
<a name="l00146"></a>00146         <span class="keywordflow">if</span> (<a class="code" href="front__panel_2main_8c.html#33e0e0ca61cfd86443ceb19d5c7ce50b" title="Get the inhibit state This function is used to get the inhibit state, which is used...">main_get_inhibit_state</a>() != <a class="code" href="front__panel_2main_8h.html#134c1d1af939afa5cdbca4c5cc75b9440ae1150bc2e673ccc633c820ec3892bf" title="Inhibit state, NOT OK to start a transmission, Radio is in TX.">INHIBIT_NOT_OK_TO_SEND_RADIO_TX</a>) {
<a name="l00147"></a>00147                 <a class="code" href="front__panel_2main_8h.html#44180c9bab74233e1e4e36be5bcf2fe1" title="Contains different statuses of buttons etc.">status</a>.<a class="code" href="structstruct__status.html#5ec7f0e741f49b1fff61e211ccab4a4d" title="Bit 0-3 = TX, Bit 4-7 = RX.">selected_ant</a> = 0;
<a name="l00148"></a>00148                 
<a name="l00149"></a>00149                 <a class="code" href="front__panel_2main_8h.html#44180c9bab74233e1e4e36be5bcf2fe1" title="Contains different statuses of buttons etc.">status</a>.<a class="code" href="structstruct__status.html#96014d1883e414c343243dc470986d1c" title="The currently selected band.">selected_band</a> = band;
<a name="l00150"></a>00150                 <a class="code" href="front__panel_2main_8h.html#44180c9bab74233e1e4e36be5bcf2fe1" title="Contains different statuses of buttons etc.">status</a>.<a class="code" href="structstruct__status.html#8dbaf3fc52937e28c6b3f73869a22b3a" title="The variable for changing to a new band.">new_band</a> = band;
<a name="l00151"></a>00151                 
<a name="l00152"></a>00152                 <a class="code" href="front__panel_2led__control_8c.html#bfdee5775ab42a7048468f5ad4dd0607" title="Turn off all band leds.">led_set_band_none</a>();
<a name="l00153"></a>00153                 <a class="code" href="front__panel_2led__control_8c.html#5bfe45c367d2201775bbf65a55ff3634" title="Set the band LEDs to the proper band.">led_set_band</a>(band);
<a name="l00154"></a>00154                 
<a name="l00155"></a>00155                 <span class="comment">//Turn off antenna leds</span>
<a name="l00156"></a>00156                 <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> i=0;i&lt;4;i++) {
<a name="l00157"></a>00157                         <a class="code" href="front__panel_2led__control_8c.html#66d6c83ed387c751253fe06a14ee842f" title="Set the TX Antenna LED status.">led_set_tx_ant</a>(i,<a class="code" href="front__panel_2led__control_8h.html#f3b2f3268e399a66b018faace7ebb18d0eebea54c4dc200be6939742385ee789" title="Used to set the LED as OFF.">LED_STATE_OFF</a>);
<a name="l00158"></a>00158                         <a class="code" href="front__panel_2led__control_8c.html#5a7a9162c3fb5416a9c2f9608c88021b" title="Set the RX Antenna LED status.">led_set_rx_ant</a>(i,<a class="code" href="front__panel_2led__control_8h.html#f3b2f3268e399a66b018faace7ebb18d0eebea54c4dc200be6939742385ee789" title="Used to set the LED as OFF.">LED_STATE_OFF</a>);
<a name="l00159"></a>00159                 }
<a name="l00160"></a>00160                 
<a name="l00161"></a>00161                 <span class="keywordflow">if</span> (band != BAND_UNDEFINED) {
<a name="l00162"></a>00162                         <a class="code" href="band__ctrl_8c.html#95c96792b3186a41830050229812285e" title="Function will load a band from the EEPROM into the current_band struct.">band_ctrl_load_band</a>(band);
<a name="l00163"></a>00163                         
<a name="l00164"></a>00164                         <span class="keywordflow">if</span> (<a class="code" href="front__panel_2main_8h.html#44180c9bab74233e1e4e36be5bcf2fe1" title="Contains different statuses of buttons etc.">status</a>.<a class="code" href="structstruct__status.html#5a07897b99cf7c72c0c543b5157043c8">current_display</a> != <a class="code" href="front__panel_2main_8h.html#d9c2b0e311750f4061a9c7058940bb6e" title="Current display is the menu system.">CURRENT_DISPLAY_MENU_SYSTEM</a>) {
<a name="l00165"></a>00165                                 <a class="code" href="front__panel_2main_8h.html#44180c9bab74233e1e4e36be5bcf2fe1" title="Contains different statuses of buttons etc.">status</a>.<a class="code" href="structstruct__status.html#5a07897b99cf7c72c0c543b5157043c8">current_display</a> = <a class="code" href="front__panel_2main_8h.html#369eb8e282a85b010f95c13f89ed78e6" title="Current display is the antenna information.">CURRENT_DISPLAY_ANTENNA_INFO</a>;
<a name="l00166"></a>00166                                 <a class="code" href="front__panel_2main_8h.html#44180c9bab74233e1e4e36be5bcf2fe1" title="Contains different statuses of buttons etc.">status</a>.<a class="code" href="structstruct__status.html#751519c9ba01b235d43e19b758c3a127">current_display_level</a> = <a class="code" href="front__panel_2main_8h.html#51cf2799b3a733a050466547798a6a4b" title="Display level current band.">DISPLAY_LEVEL_BAND</a>;
<a name="l00167"></a>00167                         }
<a name="l00168"></a>00168                 }
<a name="l00169"></a>00169                 <span class="keywordflow">else</span> {
<a name="l00170"></a>00170                         <span class="keywordflow">if</span> ((<a class="code" href="front__panel_2main_8h.html#44180c9bab74233e1e4e36be5bcf2fe1" title="Contains different statuses of buttons etc.">status</a>.<a class="code" href="structstruct__status.html#5a07897b99cf7c72c0c543b5157043c8">current_display</a> != <a class="code" href="front__panel_2main_8h.html#08dea390561b6cc7f300368803425516" title="Current display is the shutdown in progress view.">CURRENT_DISPLAY_SHUTDOWN_VIEW</a>) &amp;&amp; (<a class="code" href="front__panel_2main_8h.html#44180c9bab74233e1e4e36be5bcf2fe1" title="Contains different statuses of buttons etc.">status</a>.<a class="code" href="structstruct__status.html#5a07897b99cf7c72c0c543b5157043c8">current_display</a> != <a class="code" href="front__panel_2main_8h.html#d9c2b0e311750f4061a9c7058940bb6e" title="Current display is the menu system.">CURRENT_DISPLAY_MENU_SYSTEM</a>))
<a name="l00171"></a>00171                                 <a class="code" href="front__panel_2main_8h.html#44180c9bab74233e1e4e36be5bcf2fe1" title="Contains different statuses of buttons etc.">status</a>.<a class="code" href="structstruct__status.html#5a07897b99cf7c72c0c543b5157043c8">current_display</a> = <a class="code" href="front__panel_2main_8h.html#3f63a3eafe2a7f9a7f4eab952e939e39" title="Current display is the openASC logo.">CURRENT_DISPLAY_LOGO</a>;
<a name="l00172"></a>00172                 }
<a name="l00173"></a>00173                 
<a name="l00174"></a>00174                 <a class="code" href="antenna__ctrl_8c.html#c8a569961df8c43aa12bfaebd4b639c3" title="Function which will deactivate all activated rx antenna ctrl band outputs, using...">antenna_ctrl_deactivate_all_rx_band</a>();
<a name="l00175"></a>00175                 <a class="code" href="antenna__ctrl_8c.html#d67893d0c54f78d5dd2df22a2b46b8fb" title="Function which will deactivate all activated antenna ctrl outputs, using type BUS_CMD_DRIVER_DEACTIV...">antenna_ctrl_deactivate_all</a>();
<a name="l00176"></a>00176                 <a class="code" href="band__ctrl_8c.html#7081025e6923a7a4d8d35e61144f494e" title="Function which will deactiavate all band outptus, BUS_CMD_DRIVER_DEACTIVATE_ALL_BAND_OUTPUTS...">band_ctrl_deactivate_all</a>();
<a name="l00177"></a>00177 <span class="comment">//              sub_menu_deactivate_all();</span>
<a name="l00178"></a>00178                 <a class="code" href="front__panel_2led__control_8c.html#1842fb4da0f83f83c77493a3dd2ddfb8" title="Set the RX antenna LED status.">led_set_rxant</a>(<a class="code" href="front__panel_2led__control_8h.html#f3b2f3268e399a66b018faace7ebb18d0eebea54c4dc200be6939742385ee789" title="Used to set the LED as OFF.">LED_STATE_OFF</a>);
<a name="l00179"></a>00179                 <a class="code" href="front__panel_2main_8c.html#fd9ab4725abe99a112bd35bbba063389" title="Set the rotary knob function.">set_knob_function</a>(<a class="code" href="front__panel_2main_8h.html#809998ce457992aae0323f1854d29bdb" title="Auto select, pick the one which is most likely to be used.">KNOB_FUNCTION_AUTO</a>);
<a name="l00180"></a>00180                 
<a name="l00181"></a>00181                 <a class="code" href="front__panel_2main_8h.html#44180c9bab74233e1e4e36be5bcf2fe1" title="Contains different statuses of buttons etc.">status</a>.<a class="code" href="structstruct__status.html#3e606ec5f1d11ef7e66c1e6f88ea43eb">selected_rx_antenna</a> = 0;
<a name="l00182"></a>00182                 <a class="code" href="antenna__ctrl_8c.html#514bb0448df38458bf204ae9f52eacd1" title="Function used to change an rx antenna.">antenna_ctrl_change_rx_ant</a>(<a class="code" href="front__panel_2main_8h.html#44180c9bab74233e1e4e36be5bcf2fe1" title="Contains different statuses of buttons etc.">status</a>.<a class="code" href="structstruct__status.html#3e606ec5f1d11ef7e66c1e6f88ea43eb">selected_rx_antenna</a>);
<a name="l00183"></a>00183                 <a class="code" href="front__panel_2main_8h.html#44180c9bab74233e1e4e36be5bcf2fe1" title="Contains different statuses of buttons etc.">status</a>.<a class="code" href="structstruct__status.html#c807865f5c47c3a6563f6ea7744d4ba5" title="The status of different functions, like rx ant etc, see defines above.">function_status</a> &amp;= ~(1&lt;&lt;<a class="code" href="front__panel_2main_8h.html#5335a7cf4367e984d593763ecb285c9f" title="Define for function status.">FUNC_STATUS_RXANT</a>);
<a name="l00184"></a>00184                 
<a name="l00185"></a>00185                 <span class="keywordflow">if</span> (band != BAND_UNDEFINED) {
<a name="l00186"></a>00186                         <span class="comment">//TODO: Change to correct band portion</span>
<a name="l00187"></a>00187                         <a class="code" href="band__ctrl_8c.html#04e64b2486df76aaf97baf61ff70896a" title="Send the output string for the current band to the bus.">band_ctrl_send_band_data_to_bus</a>(<a class="code" href="front__panel_2main_8h.html#44180c9bab74233e1e4e36be5bcf2fe1" title="Contains different statuses of buttons etc.">status</a>.<a class="code" href="structstruct__status.html#35243e81f3d444bee3f5104f323a8e35" title="CURRENT Band portion selected.">current_band_portion</a>);
<a name="l00188"></a>00188                         
<a name="l00189"></a>00189                         <span class="comment">//Send RX antenna band data to the bus</span>
<a name="l00190"></a>00190                         <a class="code" href="antenna__ctrl_8c.html#d10d2760a5ef3cd190cb010a1d92d3bc" title="Send the output string for the rx antenna to the bus.">antenna_ctrl_send_rx_ant_band_data_to_bus</a>(band);
<a name="l00191"></a>00191                         <a class="code" href="antenna__ctrl_8c.html#3d68a22e57a045367d7e8041498edb61" title="Function which will select the default antenna for this band if it is configured...">antenna_ctrl_select_default_ant</a>();
<a name="l00192"></a>00192                         
<a name="l00193"></a>00193                         <span class="comment">//Activate all default sub menu options</span>
<a name="l00194"></a>00194         <span class="comment">//              sub_menu_activate_all();</span>
<a name="l00195"></a>00195                 }
<a name="l00196"></a>00196                 
<a name="l00197"></a>00197                 <a class="code" href="front__panel_2main_8c.html#b07bb29d6209caf66d9510c77909473f" title="Function which updates the status of the PTT This function will check various sources...">main_update_ptt_status</a>();
<a name="l00198"></a>00198 
<a name="l00199"></a>00199                 <span class="comment">//Update the display</span>
<a name="l00200"></a>00200                 <a class="code" href="front__panel_2main_8c.html#2c307bda82ec7f710fadd8606b25e15a" title="Sets the flag that the display should be updated.">main_update_display</a>();
<a name="l00201"></a>00201         }
<a name="l00202"></a>00202 }
<a name="l00203"></a>00203 
<a name="l00205"></a><a class="code" href="band__ctrl_8h.html#7081025e6923a7a4d8d35e61144f494e">00205</a> <span class="keywordtype">void</span> <a class="code" href="band__ctrl_8c.html#7081025e6923a7a4d8d35e61144f494e" title="Function which will deactiavate all band outptus, BUS_CMD_DRIVER_DEACTIVATE_ALL_BAND_OUTPUTS...">band_ctrl_deactivate_all</a>(<span class="keywordtype">void</span>) {
<a name="l00206"></a>00206         <span class="keywordflow">if</span> (<a class="code" href="band__ctrl_8c.html#95dd3b6a390eb053adecba3f5fee3d5d" title="The number of devices we have activated outputs on.">current_band_activated_outputs_length</a> &gt; 0) {
<a name="l00207"></a>00207                 <a class="code" href="antenna__ctrl_8c.html#617a964884601fef0e8559094ade5e3a" title="This function will go through a parameter with addresses and send a command to it...">antenna_ctrl_deactivate_outputs</a>(<a class="code" href="band__ctrl_8c.html#99322d1503c4eddf338c256c99fb52e2" title="Array which we use to keep track of which devices we have been activating outputs...">current_band_activated_outputs</a>, <a class="code" href="band__ctrl_8c.html#95dd3b6a390eb053adecba3f5fee3d5d" title="The number of devices we have activated outputs on.">current_band_activated_outputs_length</a>, <a class="code" href="bus__commands_8h.html#c90d7b296d00137a869e0c4d09bc445b">BUS_CMD_DRIVER_DEACTIVATE_ALL_BAND_OUTPUTS</a>);
<a name="l00208"></a>00208                 <a class="code" href="band__ctrl_8c.html#95dd3b6a390eb053adecba3f5fee3d5d" title="The number of devices we have activated outputs on.">current_band_activated_outputs_length</a> = 0;
<a name="l00209"></a>00209         }
<a name="l00210"></a>00210 }
<a name="l00211"></a>00211 
<a name="l00213"></a><a class="code" href="band__ctrl_8h.html#8318112bb7a0d18e57bd33c2d27d0d95">00213</a> <span class="keywordtype">void</span> <a class="code" href="band__ctrl_8c.html#8318112bb7a0d18e57bd33c2d27d0d95" title="Loads the band limits into the band limits struct.">band_ctrl_load_band_limits</a>(<span class="keywordtype">void</span>) {
<a name="l00214"></a>00214         <a class="code" href="structstruct__band.html" title="Struct of band data.">struct_band</a> temp_band;
<a name="l00215"></a>00215         
<a name="l00216"></a>00216         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> i=0;i&lt;9;i++) {
<a name="l00217"></a>00217                 <span class="comment">//Retrieve the band data from the EEPROM</span>
<a name="l00218"></a>00218                 <a class="code" href="eeprom_8c.html#6ec03600842aca7894be5d5e541552b6" title="Returns the band data.">eeprom_get_band_data</a>(i+1,&amp;temp_band);
<a name="l00219"></a>00219                                 
<a name="l00220"></a>00220                 <a class="code" href="band__ctrl_8h.html#4802430297328f2750faa537b456365b" title="The band limits, an array with size 9.">band_limits</a>[i].<a class="code" href="structstruct__band__limits.html#ccb7dd7c0bccb9458fdf17bf651dd8b6" title="The low limit of the lower portion of the band.">low_portion_low_limit</a> = temp_band.<a class="code" href="structstruct__band.html#3a22e17c781330ff1c74ba3937827859" title="The low limit of the lower portion of the band.">low_portion_low_limit</a>;
<a name="l00221"></a>00221                 <a class="code" href="band__ctrl_8h.html#4802430297328f2750faa537b456365b" title="The band limits, an array with size 9.">band_limits</a>[i].<a class="code" href="structstruct__band__limits.html#31738ae8497bade5209cfb8443c8d51c" title="The high limit of the lower portion of the band.">low_portion_high_limit</a> = temp_band.<a class="code" href="structstruct__band.html#5d49885cc511be8fa45b305f7cab7355" title="The high limit of the lower portion of the band.">low_portion_high_limit</a>;
<a name="l00222"></a>00222                 <a class="code" href="band__ctrl_8h.html#4802430297328f2750faa537b456365b" title="The band limits, an array with size 9.">band_limits</a>[i].<a class="code" href="structstruct__band__limits.html#6d10d9fa9d75f0431b419574d27db917" title="The low limit of the higher portion of the band.">high_portion_low_limit</a> = temp_band.<a class="code" href="structstruct__band.html#5a0163b339f55c2290f39fb33080ecbf" title="The low limit of the higher portion of the band.">high_portion_low_limit</a>;
<a name="l00223"></a>00223                 <a class="code" href="band__ctrl_8h.html#4802430297328f2750faa537b456365b" title="The band limits, an array with size 9.">band_limits</a>[i].<a class="code" href="structstruct__band__limits.html#738c8793b6f23e397229ecc7602e3401" title="The high limit of the higher portion of the band.">high_portion_high_limit</a> = temp_band.<a class="code" href="structstruct__band.html#e7a3d1bf549fce284b2cb4e561766781" title="The high limit of the higher portion of the band.">high_portion_high_limit</a>;
<a name="l00224"></a>00224         }
<a name="l00225"></a>00225 }
<a name="l00226"></a>00226 
<a name="l00229"></a><a class="code" href="band__ctrl_8h.html#7000f5c890a6f56846688316de9a9d46">00229</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="band__ctrl_8c.html#7000f5c890a6f56846688316de9a9d46" title="Retrieve the lower frequency limit of the low band limit.">band_ctrl_get_low_portion_low</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> band) {
<a name="l00230"></a>00230         <span class="keywordflow">return</span>(<a class="code" href="band__ctrl_8h.html#4802430297328f2750faa537b456365b" title="The band limits, an array with size 9.">band_limits</a>[band-1].low_portion_low_limit);
<a name="l00231"></a>00231 }
<a name="l00232"></a>00232 
<a name="l00235"></a><a class="code" href="band__ctrl_8h.html#3081981043c523a48c93a748fafab483">00235</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="band__ctrl_8c.html#3081981043c523a48c93a748fafab483" title="Retrieve the higher frequency limit of the low band limit.">band_ctrl_get_low_portion_high</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> band) {
<a name="l00236"></a>00236         <span class="keywordflow">return</span>(<a class="code" href="band__ctrl_8h.html#4802430297328f2750faa537b456365b" title="The band limits, an array with size 9.">band_limits</a>[band-1].low_portion_high_limit);
<a name="l00237"></a>00237 }
<a name="l00238"></a>00238 
<a name="l00241"></a><a class="code" href="band__ctrl_8h.html#15a19bda71651bbce5cdad2a09bf595e">00241</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="band__ctrl_8c.html#15a19bda71651bbce5cdad2a09bf595e" title="Retrieve the lower frequency limit of the high band limit.">band_ctrl_get_high_portion_low</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> band) {
<a name="l00242"></a>00242         <span class="keywordflow">return</span>(<a class="code" href="band__ctrl_8h.html#4802430297328f2750faa537b456365b" title="The band limits, an array with size 9.">band_limits</a>[band-1].high_portion_low_limit);
<a name="l00243"></a>00243 }
<a name="l00244"></a>00244 
<a name="l00247"></a><a class="code" href="band__ctrl_8h.html#99e7008d39a767444fef44c28eac8e3c">00247</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="band__ctrl_8c.html#99e7008d39a767444fef44c28eac8e3c" title="Retrieve the higher frequency limit of the high band limit.">band_ctrl_get_high_portion_high</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> band) {
<a name="l00248"></a>00248         <span class="keywordflow">return</span>(<a class="code" href="band__ctrl_8h.html#4802430297328f2750faa537b456365b" title="The band limits, an array with size 9.">band_limits</a>[band-1].high_portion_high_limit);
<a name="l00249"></a>00249 }
<a name="l00250"></a>00250 
<a name="l00253"></a><a class="code" href="band__ctrl_8h.html#5c38d45679e5b24438dbac6f5c531a72">00253</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="band__ctrl_8c.html#5c38d45679e5b24438dbac6f5c531a72" title="Retrieve the higher frequency output string, of max length BAND_OUTPUT_STR_SIZE.">band_ctrl_get_high_output_str</a>(<span class="keywordtype">void</span>) {
<a name="l00254"></a>00254         <span class="keywordflow">return</span>(current_band.<a class="code" href="structstruct__band.html#24999518468ee9a16fb8c33eb6ad6d98" title="These outputs are activated when you enter the high area of a band.">band_high_output_str</a>);
<a name="l00255"></a>00255 }
<a name="l00256"></a>00256 
<a name="l00259"></a><a class="code" href="band__ctrl_8h.html#78d1192f01a3f645e2f0af0730eb0d8a">00259</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="band__ctrl_8c.html#78d1192f01a3f645e2f0af0730eb0d8a" title="Retrieve the lower frequency output string, of max length BAND_OUTPUT_STR_SIZE.">band_ctrl_get_low_output_str</a>(<span class="keywordtype">void</span>) {
<a name="l00260"></a>00260         <span class="keywordflow">return</span>(current_band.<a class="code" href="structstruct__band.html#010fd732dc84bdf3ba7e4f8424585571" title="These outputs are activated when you enter the low area of a band.">band_low_output_str</a>);
<a name="l00261"></a>00261 }
<a name="l00262"></a>00262 
<a name="l00265"></a><a class="code" href="band__ctrl_8c.html#6bf2ce0c200183ad067d41b7051a9050">00265</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="band__ctrl_8c.html#6bf2ce0c200183ad067d41b7051a9050" title="Retrieve which band portion we are currently at.">band_ctrl_get_portion</a>(<span class="keywordtype">void</span>) {
<a name="l00266"></a>00266         <span class="keywordflow">if</span> ((<a class="code" href="front__panel_2main_8h.html#74a522f526f7b89b1db24714c80ecdcf" title="Contains settings which will be saved and restored each time the box is turned on/off...">runtime_settings</a>.<a class="code" href="structstruct__runtime__settings.html#06eebb130ee972b4e5f93dd6b9f7a206" title="Band change mode.">band_change_mode</a> == <a class="code" href="front__panel_2main_8h.html#36225caec680f0f1ed29d95205308bc8" title="Band changes are done manually.">BAND_CHANGE_MODE_MANUAL</a>) || ((<a class="code" href="front__panel_2main_8h.html#74a522f526f7b89b1db24714c80ecdcf" title="Contains settings which will be saved and restored each time the box is turned on/off...">runtime_settings</a>.<a class="code" href="structstruct__runtime__settings.html#06eebb130ee972b4e5f93dd6b9f7a206" title="Band change mode.">band_change_mode</a> == <a class="code" href="front__panel_2main_8h.html#c896e6d179d6d2b30cd01aa20355bd13" title="Band changes are done automatically.">BAND_CHANGE_MODE_AUTO</a>) &amp;&amp; (<a class="code" href="radio__interface_8c.html#2a21b606f4854195179fba78e566dc68" title="Get which radio interface is used.">radio_interface_get_interface</a>() == <a class="code" href="radio__interface_8h.html#e0568caf0f79d2d3a75940d52617e311" title="BCD interface that connects the radio.">RADIO_INTERFACE_BCD</a>))) {
<a name="l00267"></a>00267                 <span class="keywordflow">if</span> (<a class="code" href="front__panel_2main_8h.html#44180c9bab74233e1e4e36be5bcf2fe1" title="Contains different statuses of buttons etc.">status</a>.<a class="code" href="structstruct__status.html#35243e81f3d444bee3f5104f323a8e35" title="CURRENT Band portion selected.">current_band_portion</a> == BAND_HIGH)
<a name="l00268"></a>00268                         <span class="keywordflow">return</span>(BAND_HIGH);
<a name="l00269"></a>00269                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="front__panel_2main_8h.html#44180c9bab74233e1e4e36be5bcf2fe1" title="Contains different statuses of buttons etc.">status</a>.<a class="code" href="structstruct__status.html#35243e81f3d444bee3f5104f323a8e35" title="CURRENT Band portion selected.">current_band_portion</a> == BAND_LOW)
<a name="l00270"></a>00270                         <span class="keywordflow">return</span>(BAND_LOW);
<a name="l00271"></a>00271                 <span class="keywordflow">else</span>
<a name="l00272"></a>00272                         <span class="keywordflow">return</span>(BAND_UNDEFINED);
<a name="l00273"></a>00273         }
<a name="l00274"></a>00274         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="front__panel_2main_8h.html#74a522f526f7b89b1db24714c80ecdcf" title="Contains settings which will be saved and restored each time the box is turned on/off...">runtime_settings</a>.<a class="code" href="structstruct__runtime__settings.html#06eebb130ee972b4e5f93dd6b9f7a206" title="Band change mode.">band_change_mode</a> == <a class="code" href="front__panel_2main_8h.html#c896e6d179d6d2b30cd01aa20355bd13" title="Band changes are done automatically.">BAND_CHANGE_MODE_AUTO</a>) {
<a name="l00275"></a>00275                 <span class="keywordflow">return</span>(<a class="code" href="radio__interface_8c.html#4a29bb17605c63566c6daa1e2c3f901d">radio_get_band_portion</a>());
<a name="l00276"></a>00276         }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278         <span class="keywordflow">return</span>(BAND_UNDEFINED);
<a name="l00279"></a>00279 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed May 19 20:56:57 2010 for uC by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
