<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>uC: front_panel/sub_menu.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>front_panel/sub_menu.c</h1><a href="sub__menu_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00008"></a>00008 <span class="comment">//    Copyright (C) 2008  Mikael Larsmark, SM2WMV</span>
<a name="l00009"></a>00009 <span class="comment">//</span>
<a name="l00010"></a>00010 <span class="comment">//    This program is free software: you can redistribute it and/or modify</span>
<a name="l00011"></a>00011 <span class="comment">//    it under the terms of the GNU General Public License as published by</span>
<a name="l00012"></a>00012 <span class="comment">//    the Free Software Foundation, either version 3 of the License, or</span>
<a name="l00013"></a>00013 <span class="comment">//    (at your option) any later version.</span>
<a name="l00014"></a>00014 <span class="comment">//</span>
<a name="l00015"></a>00015 <span class="comment">//    This program is distributed in the hope that it will be useful,</span>
<a name="l00016"></a>00016 <span class="comment">//    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00017"></a>00017 <span class="comment">//    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00018"></a>00018 <span class="comment">//    GNU General Public License for more details.</span>
<a name="l00019"></a>00019 <span class="comment">//</span>
<a name="l00020"></a>00020 <span class="comment">//    You should have received a copy of the GNU General Public License</span>
<a name="l00021"></a>00021 <span class="comment">//    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;avr/io.h&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#include "<a class="code" href="sub__menu_8h.html" title="Antenna sub menu functions.">sub_menu.h</a>"</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include "<a class="code" href="antenna__ctrl_8h.html" title="Antenna control functions.">antenna_ctrl.h</a>"</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include "main.h"</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include "<a class="code" href="eeprom_8h.html" title="EEPROM functions.">eeprom.h</a>"</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include "<a class="code" href="band__ctrl_8h.html" title="Band control functions.">band_ctrl.h</a>"</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#include "../global.h"</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include "../internal_comm.h"</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="comment">/* Include the bus headers */</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include "../wmv_bus/bus.h"</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include "../wmv_bus/bus_rx_queue.h"</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include "../wmv_bus/bus_tx_queue.h"</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include "../wmv_bus/bus_commands.h"</span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="comment">//TODO: Fix the implementation if more than one antenna has got a sub menu, should be done in event_handler.c</span>
<a name="l00044"></a>00044 <span class="comment">//TODO: Maybe fix so that we are able to select RX antennas while in the sub menu of an ARRAY?</span>
<a name="l00045"></a>00045 
<a name="l00047"></a><a class="code" href="sub__menu_8c.html#7bb78d8f5fb30e646eed0a007d76c654">00047</a> <a class="code" href="structstruct__sub__menu__array.html" title="Struct of a sub menu with the type array.">struct_sub_menu_array</a> <a class="code" href="sub__menu_8c.html#7bb78d8f5fb30e646eed0a007d76c654" title="Current sub menu array.">current_sub_menu_array</a>[4];
<a name="l00048"></a>00048 
<a name="l00050"></a><a class="code" href="sub__menu_8c.html#3e64ac1dd1512a5bf87d7f4f212b4a7b">00050</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="sub__menu_8c.html#3e64ac1dd1512a5bf87d7f4f212b4a7b" title="Which option is currently selected of the sub menu options.">curr_option_selected</a>[4] = {0,0,0,0};
<a name="l00051"></a>00051 
<a name="l00053"></a><a class="code" href="sub__menu_8c.html#f85a5f56eea7c72a924acc04cdf01f98">00053</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="sub__menu_8c.html#f85a5f56eea7c72a924acc04cdf01f98" title="Array which we store the current devices which we have activated antenna outputs...">current_activated_sub_outputs</a>[4][<a class="code" href="front__panel_2main_8h.html#ce8406b719b9e401ef67d18fc47cab7d" title="The max size of the sub menu array output str size.">SUB_MENU_ARRAY_STR_SIZE</a>];
<a name="l00054"></a>00054 
<a name="l00056"></a><a class="code" href="sub__menu_8c.html#2194ee56c3a6218206e1b537812ccdd3">00056</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="sub__menu_8c.html#2194ee56c3a6218206e1b537812ccdd3" title="How many devices we have activated antenna outputs on.">current_activated_sub_outputs_length</a>[4] = {0,0,0,0};
<a name="l00057"></a>00057 
<a name="l00060"></a><a class="code" href="sub__menu_8h.html#1070bc0cf80e49b60d21255cb9e656bd">00060</a> <span class="keywordtype">void</span> <a class="code" href="sub__menu_8c.html#1070bc0cf80e49b60d21255cb9e656bd" title="Load a set of sub menu from the EEPROM for a specific band.">sub_menu_load</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> band_index) {
<a name="l00061"></a>00061         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> sub_menu_type[4];
<a name="l00062"></a>00062                 
<a name="l00063"></a>00063         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> i=0;i&lt;4;i++) {
<a name="l00064"></a>00064                 <a class="code" href="sub__menu_8c.html#3e64ac1dd1512a5bf87d7f4f212b4a7b" title="Which option is currently selected of the sub menu options.">curr_option_selected</a>[i] = 0;
<a name="l00065"></a>00065                 
<a name="l00066"></a>00066                 sub_menu_type[i] = <a class="code" href="antenna__ctrl_8c.html#a00ccf2aa2b062bb0d95817067c656ff" title="Get which kind of sub meny type an antenna has got.">antenna_ctrl_get_sub_menu_type</a>(i);
<a name="l00067"></a>00067                 
<a name="l00068"></a>00068                 <span class="keywordflow">if</span> (sub_menu_type[i] == <a class="code" href="front__panel_2main_8h.html#96b3f56b0dc9e956330d701f31e8301e" title="Sub menu type 4-SQ.">SUBMENU_VERT_ARRAY</a>)
<a name="l00069"></a>00069                         <a class="code" href="eeprom_8c.html#0b78120d991f6d5aeff7988b93f443e0" title="Get the struct_sub_menu_array structure from the EEPROM.">eeprom_get_ant_sub_menu_array_structure</a>(band_index, i, &amp;current_sub_menu_array[i]);
<a name="l00070"></a>00070         }
<a name="l00071"></a>00071 }
<a name="l00072"></a>00072 
<a name="l00077"></a><a class="code" href="sub__menu_8h.html#c2b58f2d273fadec85e84063104eabaf">00077</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="sub__menu_8c.html#c2b58f2d273fadec85e84063104eabaf" title="Get the text for the sub menu.">sub_menu_get_text</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ant_index, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> pos) {
<a name="l00078"></a>00078         <span class="keywordflow">if</span> (<a class="code" href="antenna__ctrl_8c.html#a00ccf2aa2b062bb0d95817067c656ff" title="Get which kind of sub meny type an antenna has got.">antenna_ctrl_get_sub_menu_type</a>(ant_index) == <a class="code" href="front__panel_2main_8h.html#96b3f56b0dc9e956330d701f31e8301e" title="Sub menu type 4-SQ.">SUBMENU_VERT_ARRAY</a>) {
<a name="l00079"></a>00079                 <span class="keywordflow">return</span>(current_sub_menu_array[ant_index].direction_name[pos]);
<a name="l00080"></a>00080         }
<a name="l00081"></a>00081         
<a name="l00082"></a>00082         <span class="keywordflow">return</span>(<span class="stringliteral">"   "</span>);
<a name="l00083"></a>00083 }
<a name="l00084"></a>00084 
<a name="l00088"></a><a class="code" href="sub__menu_8h.html#3172f5b466813a529713bc67394a4193">00088</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="sub__menu_8c.html#3172f5b466813a529713bc67394a4193" title="Get the current position of the sub menu cursor.">sub_menu_get_current_pos</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ant_index) {
<a name="l00089"></a>00089         <span class="keywordflow">return</span>(<a class="code" href="sub__menu_8c.html#3e64ac1dd1512a5bf87d7f4f212b4a7b" title="Which option is currently selected of the sub menu options.">curr_option_selected</a>[ant_index]);
<a name="l00090"></a>00090 }
<a name="l00091"></a>00091 
<a name="l00095"></a><a class="code" href="sub__menu_8h.html#59d5dbe1bff938b9fd4cdb47ef22fe59">00095</a> <span class="keywordtype">void</span> <a class="code" href="sub__menu_8c.html#59d5dbe1bff938b9fd4cdb47ef22fe59" title="Set the current sub menu option.">sub_menu_set_current_pos</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ant_index, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> new_pos) {
<a name="l00096"></a>00096         <a class="code" href="sub__menu_8c.html#3e64ac1dd1512a5bf87d7f4f212b4a7b" title="Which option is currently selected of the sub menu options.">curr_option_selected</a>[ant_index] = new_pos;
<a name="l00097"></a>00097 }
<a name="l00098"></a>00098 
<a name="l00101"></a><a class="code" href="sub__menu_8h.html#c17081a0f178032151b20db872b6b2fa">00101</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="sub__menu_8c.html#c17081a0f178032151b20db872b6b2fa" title="Get the number of antennas which has got a sub menu configured.">sub_menu_get_count</a>(<span class="keywordtype">void</span>) {
<a name="l00102"></a>00102         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> temp = 0;
<a name="l00103"></a>00103         
<a name="l00104"></a>00104         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> i=0;i&lt;4;i++)
<a name="l00105"></a>00105                 <span class="keywordflow">if</span> (<a class="code" href="antenna__ctrl_8c.html#a00ccf2aa2b062bb0d95817067c656ff" title="Get which kind of sub meny type an antenna has got.">antenna_ctrl_get_sub_menu_type</a>(i) != <a class="code" href="front__panel_2main_8h.html#525d9215cd48b0126a8f9f7b663c1828" title="Sub menu type NONE.">SUBMENU_NONE</a>)
<a name="l00106"></a>00106                         temp++;
<a name="l00107"></a>00107         
<a name="l00108"></a>00108         <span class="keywordflow">return</span>(temp);
<a name="l00109"></a>00109 }
<a name="l00110"></a>00110 
<a name="l00114"></a><a class="code" href="sub__menu_8h.html#fe72c5037c9593de0cac6a2f03240cc5">00114</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="sub__menu_8c.html#fe72c5037c9593de0cac6a2f03240cc5" title="Get the sub menu type of an antenna.">sub_menu_get_type</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ant_index) {
<a name="l00115"></a>00115         <span class="keywordflow">return</span>(<a class="code" href="antenna__ctrl_8c.html#a00ccf2aa2b062bb0d95817067c656ff" title="Get which kind of sub meny type an antenna has got.">antenna_ctrl_get_sub_menu_type</a>(ant_index));
<a name="l00116"></a>00116 }
<a name="l00117"></a>00117 
<a name="l00120"></a><a class="code" href="sub__menu_8h.html#234aa975183ff8d2582b247dd7c89b04">00120</a> <span class="keywordtype">void</span> <a class="code" href="sub__menu_8c.html#234aa975183ff8d2582b247dd7c89b04" title="This function should be called when we wish to decrease the selected sub menu option...">sub_menu_pos_down</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ant_index) {
<a name="l00121"></a>00121         <span class="keywordflow">if</span> (<a class="code" href="sub__menu_8c.html#fe72c5037c9593de0cac6a2f03240cc5" title="Get the sub menu type of an antenna.">sub_menu_get_type</a>(ant_index) == <a class="code" href="front__panel_2main_8h.html#96b3f56b0dc9e956330d701f31e8301e" title="Sub menu type 4-SQ.">SUBMENU_VERT_ARRAY</a>) {
<a name="l00122"></a>00122                 <span class="keywordflow">if</span> (<a class="code" href="sub__menu_8c.html#3172f5b466813a529713bc67394a4193" title="Get the current position of the sub menu cursor.">sub_menu_get_current_pos</a>(ant_index) &gt; 0)
<a name="l00123"></a>00123                         <a class="code" href="sub__menu_8c.html#59d5dbe1bff938b9fd4cdb47ef22fe59" title="Set the current sub menu option.">sub_menu_set_current_pos</a>(ant_index, <a class="code" href="sub__menu_8c.html#3172f5b466813a529713bc67394a4193" title="Get the current position of the sub menu cursor.">sub_menu_get_current_pos</a>(ant_index)-1);
<a name="l00124"></a>00124                 <span class="keywordflow">else</span>
<a name="l00125"></a>00125                         <a class="code" href="sub__menu_8c.html#59d5dbe1bff938b9fd4cdb47ef22fe59" title="Set the current sub menu option.">sub_menu_set_current_pos</a>(ant_index,current_sub_menu_array[ant_index].direction_count-1);
<a name="l00126"></a>00126         }
<a name="l00127"></a>00127 }
<a name="l00128"></a>00128 
<a name="l00131"></a><a class="code" href="sub__menu_8h.html#693faabfba9ef01f271987eb38763c38">00131</a> <span class="keywordtype">void</span> <a class="code" href="sub__menu_8c.html#693faabfba9ef01f271987eb38763c38" title="This function should be called when we wish to increase the selected sub menu option...">sub_menu_pos_up</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ant_index) {
<a name="l00132"></a>00132         <span class="keywordflow">if</span> (<a class="code" href="sub__menu_8c.html#fe72c5037c9593de0cac6a2f03240cc5" title="Get the sub menu type of an antenna.">sub_menu_get_type</a>(ant_index) == <a class="code" href="front__panel_2main_8h.html#96b3f56b0dc9e956330d701f31e8301e" title="Sub menu type 4-SQ.">SUBMENU_VERT_ARRAY</a>) {
<a name="l00133"></a>00133                 <span class="keywordflow">if</span> (<a class="code" href="sub__menu_8c.html#3172f5b466813a529713bc67394a4193" title="Get the current position of the sub menu cursor.">sub_menu_get_current_pos</a>(ant_index) &lt; current_sub_menu_array[ant_index].direction_count - 1)
<a name="l00134"></a>00134                         <a class="code" href="sub__menu_8c.html#59d5dbe1bff938b9fd4cdb47ef22fe59" title="Set the current sub menu option.">sub_menu_set_current_pos</a>(ant_index, <a class="code" href="sub__menu_8c.html#3172f5b466813a529713bc67394a4193" title="Get the current position of the sub menu cursor.">sub_menu_get_current_pos</a>(ant_index)+1);
<a name="l00135"></a>00135                 <span class="keywordflow">else</span>
<a name="l00136"></a>00136                         <a class="code" href="sub__menu_8c.html#59d5dbe1bff938b9fd4cdb47ef22fe59" title="Set the current sub menu option.">sub_menu_set_current_pos</a>(ant_index,0);
<a name="l00137"></a>00137         }
<a name="l00138"></a>00138 }
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 
<a name="l00144"></a><a class="code" href="sub__menu_8h.html#8de7774ddfb80f8a09829cf327ab50e3">00144</a> <span class="keywordtype">void</span> <a class="code" href="sub__menu_8c.html#8de7774ddfb80f8a09829cf327ab50e3" title="Send the output string for the sub menu position to the bus.">sub_menu_send_data_to_bus</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ant_index, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> pos) {
<a name="l00145"></a>00145         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> activate_cmd, deactivate_cmd, deactivate_all_cmd;
<a name="l00146"></a>00146         
<a name="l00147"></a>00147         printf(<span class="stringliteral">"SEND\n"</span>);
<a name="l00148"></a>00148         
<a name="l00149"></a>00149         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> length = 0;
<a name="l00150"></a>00150         
<a name="l00151"></a>00151         <span class="keywordflow">switch</span> (ant_index) {
<a name="l00152"></a>00152                 <span class="keywordflow">case</span> 0:
<a name="l00153"></a>00153                         activate_cmd = <a class="code" href="bus__commands_8h.html#7202ab208931af2bb1e7bed5df0db7c8">BUS_CMD_DRIVER_ACTIVATE_SUBMENU_ANT1_OUTPUT</a>;
<a name="l00154"></a>00154                         deactivate_cmd = <a class="code" href="bus__commands_8h.html#beae1947a31f4f741f1bcc80f0bd18b6">BUS_CMD_DRIVER_DEACTIVATE_SUBMENU_ANT1_OUTPUT</a>;
<a name="l00155"></a>00155                         deactivate_all_cmd = <a class="code" href="bus__commands_8h.html#3a110def39ac4c21171e86a723323773">BUS_CMD_DRIVER_DEACTIVATE_ALL_SUBMENU_ANT1_OUTPUTS</a>;
<a name="l00156"></a>00156                         
<a name="l00157"></a>00157                         length = current_sub_menu_array[0].<a class="code" href="structstruct__sub__menu__array.html#06ad1fe923e65b2141b055fdb5686f3e" title="The length of the output str.">output_str_dir_length</a>[pos];
<a name="l00158"></a>00158                         <span class="keywordflow">break</span>;
<a name="l00159"></a>00159                 <span class="keywordflow">case</span> 1:
<a name="l00160"></a>00160                         activate_cmd = <a class="code" href="bus__commands_8h.html#5c7264577e0880cf186738206fcdbf86">BUS_CMD_DRIVER_ACTIVATE_SUBMENU_ANT2_OUTPUT</a>;
<a name="l00161"></a>00161                         deactivate_cmd = <a class="code" href="bus__commands_8h.html#644c09bbedbd68ee3d79bdb3698ebd45">BUS_CMD_DRIVER_DEACTIVATE_SUBMENU_ANT2_OUTPUT</a>;
<a name="l00162"></a>00162                         deactivate_all_cmd = <a class="code" href="bus__commands_8h.html#1f94f33287942b7bdbef90e950b4e973">BUS_CMD_DRIVER_DEACTIVATE_ALL_SUBMENU_ANT2_OUTPUTS</a>;
<a name="l00163"></a>00163                         
<a name="l00164"></a>00164                         length = current_sub_menu_array[1].<a class="code" href="structstruct__sub__menu__array.html#06ad1fe923e65b2141b055fdb5686f3e" title="The length of the output str.">output_str_dir_length</a>[pos];
<a name="l00165"></a>00165                         <span class="keywordflow">break</span>;
<a name="l00166"></a>00166                 <span class="keywordflow">case</span> 2:
<a name="l00167"></a>00167                         activate_cmd = <a class="code" href="bus__commands_8h.html#f99d678512b196cb15fb8090ce935095">BUS_CMD_DRIVER_ACTIVATE_SUBMENU_ANT3_OUTPUT</a>;
<a name="l00168"></a>00168                         deactivate_cmd = <a class="code" href="bus__commands_8h.html#1e0aeece2a34b9e01bf8f90bf9616362">BUS_CMD_DRIVER_DEACTIVATE_SUBMENU_ANT3_OUTPUT</a>;
<a name="l00169"></a>00169                         deactivate_all_cmd = <a class="code" href="bus__commands_8h.html#9bce71fb46009529991e2934910f6d12">BUS_CMD_DRIVER_DEACTIVATE_ALL_SUBMENU_ANT3_OUTPUTS</a>;
<a name="l00170"></a>00170                         
<a name="l00171"></a>00171                         length = current_sub_menu_array[2].<a class="code" href="structstruct__sub__menu__array.html#06ad1fe923e65b2141b055fdb5686f3e" title="The length of the output str.">output_str_dir_length</a>[pos];
<a name="l00172"></a>00172                         <span class="keywordflow">break</span>;
<a name="l00173"></a>00173                 <span class="keywordflow">case</span> 3:
<a name="l00174"></a>00174                         activate_cmd = <a class="code" href="bus__commands_8h.html#197f040e7cf670e2ea814459ce91832b">BUS_CMD_DRIVER_ACTIVATE_SUBMENU_ANT4_OUTPUT</a>;
<a name="l00175"></a>00175                         deactivate_cmd = <a class="code" href="bus__commands_8h.html#f001987a54274aeed8dd769f925b65b2">BUS_CMD_DRIVER_DEACTIVATE_SUBMENU_ANT4_OUTPUT</a>;
<a name="l00176"></a>00176                         deactivate_all_cmd = <a class="code" href="bus__commands_8h.html#c100f77243c4a22b7649dab196d779b2">BUS_CMD_DRIVER_DEACTIVATE_ALL_SUBMENU_ANT4_OUTPUTS</a>;
<a name="l00177"></a>00177                         
<a name="l00178"></a>00178                         length = current_sub_menu_array[3].<a class="code" href="structstruct__sub__menu__array.html#06ad1fe923e65b2141b055fdb5686f3e" title="The length of the output str.">output_str_dir_length</a>[pos];
<a name="l00179"></a>00179                         <span class="keywordflow">break</span>;
<a name="l00180"></a>00180                 <span class="keywordflow">default</span>:
<a name="l00181"></a>00181                         <span class="keywordflow">break</span>;
<a name="l00182"></a>00182         }
<a name="l00183"></a>00183         
<a name="l00184"></a>00184         <span class="keywordflow">if</span> (length &gt; 0) {
<a name="l00185"></a>00185                 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> temp[length];
<a name="l00186"></a>00186         
<a name="l00187"></a>00187                 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> start_pos = 0;
<a name="l00188"></a>00188                 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> count = 0;
<a name="l00189"></a>00189                 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> addr_count=0;
<a name="l00190"></a>00190 
<a name="l00191"></a>00191                 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> i=0;
<a name="l00192"></a>00192                         
<a name="l00193"></a>00193                 <a class="code" href="antenna__ctrl_8c.html#617a964884601fef0e8559094ade5e3a" title="This function will go through a parameter with addresses and send a command to it...">antenna_ctrl_deactivate_outputs</a>(<a class="code" href="sub__menu_8c.html#f85a5f56eea7c72a924acc04cdf01f98" title="Array which we store the current devices which we have activated antenna outputs...">current_activated_sub_outputs</a>[ant_index], <a class="code" href="sub__menu_8c.html#2194ee56c3a6218206e1b537812ccdd3" title="How many devices we have activated antenna outputs on.">current_activated_sub_outputs_length</a>[ant_index], deactivate_all_cmd);
<a name="l00194"></a>00194                 <a class="code" href="sub__menu_8c.html#2194ee56c3a6218206e1b537812ccdd3" title="How many devices we have activated antenna outputs on.">current_activated_sub_outputs_length</a>[ant_index] = 0;
<a name="l00195"></a>00195                 
<a name="l00196"></a>00196                 <span class="keywordflow">while</span>(i&lt;length) {
<a name="l00197"></a>00197                         <span class="keywordflow">if</span> (current_sub_menu_array[ant_index].output_str_dir[pos][i] == <a class="code" href="front__panel_2main_8h.html#91afd03683ce572620f032008c7ccd3e" title="The delimiter that seperates the outputs from which address they should be sent to...">OUTPUT_ADDR_DELIMITER</a>) {
<a name="l00198"></a>00198                                 <span class="comment">//Will add which address the message was sent to</span>
<a name="l00199"></a>00199                                 <a class="code" href="sub__menu_8c.html#f85a5f56eea7c72a924acc04cdf01f98" title="Array which we store the current devices which we have activated antenna outputs...">current_activated_sub_outputs</a>[ant_index][addr_count++] = current_sub_menu_array[ant_index].<a class="code" href="structstruct__sub__menu__array.html#d535ee8a83271a25defca75fc026ed08" title="The output strings of the different directions.">output_str_dir</a>[pos][i+1];
<a name="l00200"></a>00200                                 
<a name="l00201"></a>00201                                 <span class="keywordflow">if</span> (current_sub_menu_array[ant_index].output_str_dir[pos][i+1] != 0x00)
<a name="l00202"></a>00202                                         <a class="code" href="bus_8c.html#4c78398b39ca1a317bcd94e32d3238ed" title="Adds a message to the TX queue which will be sent as soon as possible.">bus_add_tx_message</a>(<a class="code" href="bus_8c.html#978d35e07c79199b121997d80de56655" title="Returns the address of this device.">bus_get_address</a>(), current_sub_menu_array[ant_index].output_str_dir[pos][i+1], (1&lt;&lt;<a class="code" href="bus_8h.html#76bcceff22cba96905957274b8265298">BUS_MESSAGE_FLAGS_NEED_ACK</a>), activate_cmd, count-start_pos, temp+start_pos);
<a name="l00203"></a>00203                                 <span class="keywordflow">else</span>
<a name="l00204"></a>00204                                         <a class="code" href="internal__comm_8c.html#d9191f782631f96ebe7a5d9d846ba97b" title="Add a message to the transmit queue.">internal_comm_add_tx_message</a>(activate_cmd,count-start_pos, (<span class="keywordtype">char</span> *)(temp+start_pos));
<a name="l00205"></a>00205 
<a name="l00206"></a>00206                                 start_pos += count;
<a name="l00207"></a>00207                                 i++;
<a name="l00208"></a>00208                         } 
<a name="l00209"></a>00209                         <span class="keywordflow">else</span> {
<a name="l00210"></a>00210                                 temp[count] = current_sub_menu_array[ant_index].<a class="code" href="structstruct__sub__menu__array.html#d535ee8a83271a25defca75fc026ed08" title="The output strings of the different directions.">output_str_dir</a>[pos][i];
<a name="l00211"></a>00211                                 count++;
<a name="l00212"></a>00212                         }
<a name="l00213"></a>00213                         
<a name="l00214"></a>00214                         i++;
<a name="l00215"></a>00215                 }
<a name="l00216"></a>00216                 
<a name="l00217"></a>00217                 <a class="code" href="sub__menu_8c.html#2194ee56c3a6218206e1b537812ccdd3" title="How many devices we have activated antenna outputs on.">current_activated_sub_outputs_length</a>[ant_index] = addr_count;
<a name="l00218"></a>00218         }
<a name="l00219"></a>00219         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="sub__menu_8c.html#2194ee56c3a6218206e1b537812ccdd3" title="How many devices we have activated antenna outputs on.">current_activated_sub_outputs_length</a>[ant_index] &gt; 0) {
<a name="l00220"></a>00220                 <a class="code" href="antenna__ctrl_8c.html#617a964884601fef0e8559094ade5e3a" title="This function will go through a parameter with addresses and send a command to it...">antenna_ctrl_deactivate_outputs</a>(<a class="code" href="sub__menu_8c.html#f85a5f56eea7c72a924acc04cdf01f98" title="Array which we store the current devices which we have activated antenna outputs...">current_activated_sub_outputs</a>[ant_index], <a class="code" href="sub__menu_8c.html#2194ee56c3a6218206e1b537812ccdd3" title="How many devices we have activated antenna outputs on.">current_activated_sub_outputs_length</a>[ant_index], deactivate_all_cmd);
<a name="l00221"></a>00221                 <a class="code" href="sub__menu_8c.html#2194ee56c3a6218206e1b537812ccdd3" title="How many devices we have activated antenna outputs on.">current_activated_sub_outputs_length</a>[ant_index] = 0;
<a name="l00222"></a>00222         }
<a name="l00223"></a>00223 }
<a name="l00224"></a>00224 
<a name="l00226"></a><a class="code" href="sub__menu_8h.html#20f72c68f7c5e4bcc0fb9dcbcccfff75">00226</a> <span class="keywordtype">void</span> <a class="code" href="sub__menu_8c.html#20f72c68f7c5e4bcc0fb9dcbcccfff75" title="Will deactivate all currently selected outputs which has been sent out on the bus...">sub_menu_deactivate_all</a>(<span class="keywordtype">void</span>) {
<a name="l00227"></a>00227         <span class="keywordflow">if</span> (<a class="code" href="sub__menu_8c.html#2194ee56c3a6218206e1b537812ccdd3" title="How many devices we have activated antenna outputs on.">current_activated_sub_outputs_length</a>[0] &gt; 0) {
<a name="l00228"></a>00228                 <a class="code" href="antenna__ctrl_8c.html#617a964884601fef0e8559094ade5e3a" title="This function will go through a parameter with addresses and send a command to it...">antenna_ctrl_deactivate_outputs</a>(<a class="code" href="sub__menu_8c.html#f85a5f56eea7c72a924acc04cdf01f98" title="Array which we store the current devices which we have activated antenna outputs...">current_activated_sub_outputs</a>[0], <a class="code" href="sub__menu_8c.html#2194ee56c3a6218206e1b537812ccdd3" title="How many devices we have activated antenna outputs on.">current_activated_sub_outputs_length</a>[0], <a class="code" href="bus__commands_8h.html#3a110def39ac4c21171e86a723323773">BUS_CMD_DRIVER_DEACTIVATE_ALL_SUBMENU_ANT1_OUTPUTS</a>);
<a name="l00229"></a>00229                 <a class="code" href="sub__menu_8c.html#2194ee56c3a6218206e1b537812ccdd3" title="How many devices we have activated antenna outputs on.">current_activated_sub_outputs_length</a>[0] = 0;
<a name="l00230"></a>00230         }
<a name="l00231"></a>00231         
<a name="l00232"></a>00232         <span class="keywordflow">if</span> (<a class="code" href="sub__menu_8c.html#2194ee56c3a6218206e1b537812ccdd3" title="How many devices we have activated antenna outputs on.">current_activated_sub_outputs_length</a>[1] &gt; 0) {
<a name="l00233"></a>00233                 <a class="code" href="antenna__ctrl_8c.html#617a964884601fef0e8559094ade5e3a" title="This function will go through a parameter with addresses and send a command to it...">antenna_ctrl_deactivate_outputs</a>(<a class="code" href="sub__menu_8c.html#f85a5f56eea7c72a924acc04cdf01f98" title="Array which we store the current devices which we have activated antenna outputs...">current_activated_sub_outputs</a>[1], <a class="code" href="sub__menu_8c.html#2194ee56c3a6218206e1b537812ccdd3" title="How many devices we have activated antenna outputs on.">current_activated_sub_outputs_length</a>[1], <a class="code" href="bus__commands_8h.html#1f94f33287942b7bdbef90e950b4e973">BUS_CMD_DRIVER_DEACTIVATE_ALL_SUBMENU_ANT2_OUTPUTS</a>);
<a name="l00234"></a>00234                 <a class="code" href="sub__menu_8c.html#2194ee56c3a6218206e1b537812ccdd3" title="How many devices we have activated antenna outputs on.">current_activated_sub_outputs_length</a>[1] = 0;
<a name="l00235"></a>00235         }
<a name="l00236"></a>00236         
<a name="l00237"></a>00237         <span class="keywordflow">if</span> (<a class="code" href="sub__menu_8c.html#2194ee56c3a6218206e1b537812ccdd3" title="How many devices we have activated antenna outputs on.">current_activated_sub_outputs_length</a>[2] &gt; 0) {
<a name="l00238"></a>00238                 <a class="code" href="antenna__ctrl_8c.html#617a964884601fef0e8559094ade5e3a" title="This function will go through a parameter with addresses and send a command to it...">antenna_ctrl_deactivate_outputs</a>(<a class="code" href="sub__menu_8c.html#f85a5f56eea7c72a924acc04cdf01f98" title="Array which we store the current devices which we have activated antenna outputs...">current_activated_sub_outputs</a>[2], <a class="code" href="sub__menu_8c.html#2194ee56c3a6218206e1b537812ccdd3" title="How many devices we have activated antenna outputs on.">current_activated_sub_outputs_length</a>[2], <a class="code" href="bus__commands_8h.html#9bce71fb46009529991e2934910f6d12">BUS_CMD_DRIVER_DEACTIVATE_ALL_SUBMENU_ANT3_OUTPUTS</a>);
<a name="l00239"></a>00239                 <a class="code" href="sub__menu_8c.html#2194ee56c3a6218206e1b537812ccdd3" title="How many devices we have activated antenna outputs on.">current_activated_sub_outputs_length</a>[2] = 0;
<a name="l00240"></a>00240         }
<a name="l00241"></a>00241         
<a name="l00242"></a>00242         <span class="keywordflow">if</span> (<a class="code" href="sub__menu_8c.html#2194ee56c3a6218206e1b537812ccdd3" title="How many devices we have activated antenna outputs on.">current_activated_sub_outputs_length</a>[3] &gt; 0) {
<a name="l00243"></a>00243                 <a class="code" href="antenna__ctrl_8c.html#617a964884601fef0e8559094ade5e3a" title="This function will go through a parameter with addresses and send a command to it...">antenna_ctrl_deactivate_outputs</a>(<a class="code" href="sub__menu_8c.html#f85a5f56eea7c72a924acc04cdf01f98" title="Array which we store the current devices which we have activated antenna outputs...">current_activated_sub_outputs</a>[3], <a class="code" href="sub__menu_8c.html#2194ee56c3a6218206e1b537812ccdd3" title="How many devices we have activated antenna outputs on.">current_activated_sub_outputs_length</a>[3], <a class="code" href="bus__commands_8h.html#c100f77243c4a22b7649dab196d779b2">BUS_CMD_DRIVER_DEACTIVATE_ALL_SUBMENU_ANT4_OUTPUTS</a>);
<a name="l00244"></a>00244                 <a class="code" href="sub__menu_8c.html#2194ee56c3a6218206e1b537812ccdd3" title="How many devices we have activated antenna outputs on.">current_activated_sub_outputs_length</a>[3] = 0;
<a name="l00245"></a>00245         }
<a name="l00246"></a>00246 }
<a name="l00247"></a>00247 
<a name="l00249"></a><a class="code" href="sub__menu_8h.html#d3b31cd17b571b379eb17c2c17c736e2">00249</a> <span class="keywordtype">void</span> <a class="code" href="sub__menu_8c.html#d3b31cd17b571b379eb17c2c17c736e2" title="This function will go through the sub menus and if there is one configured it will...">sub_menu_activate_all</a>(<span class="keywordtype">void</span>) {
<a name="l00250"></a>00250         <span class="comment">//Activate all the sub menu options avaible for default position #0</span>
<a name="l00251"></a>00251         <span class="keywordflow">if</span> (<a class="code" href="antenna__ctrl_8c.html#a00ccf2aa2b062bb0d95817067c656ff" title="Get which kind of sub meny type an antenna has got.">antenna_ctrl_get_sub_menu_type</a>(0) != <a class="code" href="front__panel_2main_8h.html#525d9215cd48b0126a8f9f7b663c1828" title="Sub menu type NONE.">SUBMENU_NONE</a>)
<a name="l00252"></a>00252                 <a class="code" href="sub__menu_8c.html#8de7774ddfb80f8a09829cf327ab50e3" title="Send the output string for the sub menu position to the bus.">sub_menu_send_data_to_bus</a>(0,0);
<a name="l00253"></a>00253         
<a name="l00254"></a>00254         <span class="keywordflow">if</span> (<a class="code" href="antenna__ctrl_8c.html#a00ccf2aa2b062bb0d95817067c656ff" title="Get which kind of sub meny type an antenna has got.">antenna_ctrl_get_sub_menu_type</a>(1) != <a class="code" href="front__panel_2main_8h.html#525d9215cd48b0126a8f9f7b663c1828" title="Sub menu type NONE.">SUBMENU_NONE</a>)  
<a name="l00255"></a>00255                 <a class="code" href="sub__menu_8c.html#8de7774ddfb80f8a09829cf327ab50e3" title="Send the output string for the sub menu position to the bus.">sub_menu_send_data_to_bus</a>(1,0);
<a name="l00256"></a>00256         
<a name="l00257"></a>00257         <span class="keywordflow">if</span> (<a class="code" href="antenna__ctrl_8c.html#a00ccf2aa2b062bb0d95817067c656ff" title="Get which kind of sub meny type an antenna has got.">antenna_ctrl_get_sub_menu_type</a>(2) != <a class="code" href="front__panel_2main_8h.html#525d9215cd48b0126a8f9f7b663c1828" title="Sub menu type NONE.">SUBMENU_NONE</a>)  
<a name="l00258"></a>00258                 <a class="code" href="sub__menu_8c.html#8de7774ddfb80f8a09829cf327ab50e3" title="Send the output string for the sub menu position to the bus.">sub_menu_send_data_to_bus</a>(2,0);
<a name="l00259"></a>00259         
<a name="l00260"></a>00260         <span class="keywordflow">if</span> (<a class="code" href="antenna__ctrl_8c.html#a00ccf2aa2b062bb0d95817067c656ff" title="Get which kind of sub meny type an antenna has got.">antenna_ctrl_get_sub_menu_type</a>(3) != <a class="code" href="front__panel_2main_8h.html#525d9215cd48b0126a8f9f7b663c1828" title="Sub menu type NONE.">SUBMENU_NONE</a>)
<a name="l00261"></a>00261                 <a class="code" href="sub__menu_8c.html#8de7774ddfb80f8a09829cf327ab50e3" title="Send the output string for the sub menu position to the bus.">sub_menu_send_data_to_bus</a>(3,0);
<a name="l00262"></a>00262 }
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed May 19 20:56:57 2010 for uC by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
